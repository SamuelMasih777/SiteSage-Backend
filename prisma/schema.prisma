generator client {
  provider   = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ai_insights {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  audit_id    String    @unique @db.Uuid
  summary     String?
  suggestions Json?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  audit       audits    @relation(fields: [audit_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([audit_id], map: "idx_ai_insights_audit_id")
}

model audits {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String        @db.Uuid
  url           String        @db.VarChar(2048)
  status        String        @db.VarChar(20)
  error_message String?
  created_at    DateTime?     @default(now()) @db.Timestamp(6)
  updated_at    DateTime?     @default(now()) @db.Timestamp(6)
  
  user          users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  ai_insight    ai_insights?
  report        reports?
  seo_metric    seo_metrics?

  @@index([status], map: "idx_audits_status")
  @@index([user_id], map: "idx_audits_user_id")
}

model reports {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  audit_id   String    @unique @db.Uuid
  pdf_url    String?   @db.VarChar(1024)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  audit      audits    @relation(fields: [audit_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([audit_id], map: "idx_reports_audit_id")
}

model seo_metrics {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  audit_id           String    @unique @db.Uuid
  title              String?   @db.VarChar(500)
  meta_description   String?
  h1_tags            Json?
  h2_tags            Json?
  images_total       Int?      @default(0)
  images_without_alt Int?      @default(0)
  internal_links     Int?      @default(0)
  external_links     Int?      @default(0)
  page_load_time_ms  Int?
  seo_score          Int?
  issues             Json?
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  audit              audits    @relation(fields: [audit_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([audit_id], map: "idx_seo_metrics_audit_id")
}

model users {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String    @unique @db.VarChar(255)
  password_hash String    @db.VarChar(255)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  audits        audits[]

  @@index([email], map: "idx_users_email")
}
